<!DOCTYPE html>

<script src="./assets/js/d3.v7.min.js"></script>
<script src="./assets/js/topojson.min.js"></script>
<script src="./assets/js/geoalbersuster.js"></script>

<select id = "opts">
  <optgroup label="Resolution: 500k">
    <optgroup label="&nbsp;&nbsp;State">
      <option value="state_500k_2014">State 2014 (500k)</option>
      <option value="state_500k_2015">State 2015 (500k)</option>
      <option value="state_500k_2016">State 2016 (500k)</option>
      <option value="state_500k_2017">State 2017 (500k)</option>
      <option value="state_500k_2018">State 2018 (500k)</option>
      <option value="state_500k_2019">State 2019 (500k)</option>
      <option value="state_500k_2020">State 2020 (500k)</option>
      <option value="state_500k_2021">State 2021 (500k)</option>
      <option value="state_500k_2022">State 2022 (500k)</option>
      <option value="state_500k_2023">State 2023 (500k)</option>
    </optgroup>
    <optgroup label="&nbsp;&nbsp;County">
      <option value="county_500k_2014">County 2014 (500k)</option>
      <option value="county_500k_2015">County 2015 (500k)</option>
      <option value="county_500k_2016">County 2016 (500k)</option>
      <option value="county_500k_2017">County 2017 (500k)</option>
      <option value="county_500k_2018">County 2018 (500k)</option>
      <option value="county_500k_2019">County 2019 (500k)</option>
      <option value="county_500k_2020">County 2020 (500k)</option>
      <option value="county_500k_2021">County 2021 (500k)</option>
      <option value="county_500k_2022">County 2022 (500k)</option>
      <option value="county_500k_2023">County 2023 (500k)</option>
    </optgroup>
    <optgroup label="&nbsp;&nbsp;Congressional district">
      <option value="cdistrict_500k_2014">Congressional District 2014 (500k)</option>
      <option value="cdistrict_500k_2015">Congressional District 2015 (500k)</option>
      <option value="cdistrict_500k_2016">Congressional District 2016 (500k)</option>
      <option value="cdistrict_500k_2017">Congressional District 2017 (500k)</option>
      <option value="cdistrict_500k_2018">Congressional District 2018 (500k)</option>
      <option value="cdistrict_500k_2019">Congressional District 2019 (500k)</option>
      <option value="cdistrict_500k_2020">Congressional District 2020 (500k)</option>
      <option value="cdistrict_500k_2021">Congressional District 2021 (500k)</option>
      <option value="cdistrict_500k_2022">Congressional District 2022 (500k)</option>
      <option value="cdistrict_500k_2023">Congressional District 2023 (500k)</option>
    </optgroup>
  </optgroup>
  <optgroup label="Resolution: 5m">
    <optgroup label="&nbsp;&nbsp;State">
      <option value="state_5m_2014">State 2014 (5m)</option>
      <option value="state_5m_2015">State 2015 (5m)</option>
      <option value="state_5m_2016">State 2016 (5m)</option>
      <option value="state_5m_2017">State 2017 (5m)</option>
      <option value="state_5m_2018">State 2018 (5m)</option>
      <option value="state_5m_2019">State 2019 (5m)</option>
      <option value="state_5m_2020">State 2020 (5m)</option>
      <option value="state_5m_2021">State 2021 (5m)</option>
      <option value="state_5m_2022">State 2022 (5m)</option>
      <option value="state_5m_2023">State 2023 (5m)</option>
    </optgroup>
    <optgroup label="&nbsp;&nbsp;County">
      <option value="county_5m_2014">County 2014 (5m)</option>
      <option value="county_5m_2015">County 2015 (5m)</option>
      <option value="county_5m_2016">County 2016 (5m)</option>
      <option value="county_5m_2017">County 2017 (5m)</option>
      <option value="county_5m_2018">County 2018 (5m)</option>
      <option value="county_5m_2019">County 2019 (5m)</option>
      <option value="county_5m_2020">County 2020 (5m)</option>
      <option value="county_5m_2021">County 2021 (5m)</option>
      <option value="county_5m_2022">County 2022 (5m)</option>
      <option value="county_5m_2023">County 2023 (5m)</option>
    </optgroup>
    <optgroup label="&nbsp;&nbsp;Congressional district">
      <option value="cdistrict_5m_2014">Congressional District 2014 (5m)</option>
      <option value="cdistrict_5m_2015">Congressional District 2015 (5m)</option>
      <option value="cdistrict_5m_2016">Congressional District 2016 (5m)</option>
      <option value="cdistrict_5m_2017">Congressional District 2017 (5m)</option>
      <option value="cdistrict_5m_2018">Congressional District 2018 (5m)</option>
      <option value="cdistrict_5m_2019">Congressional District 2019 (5m)</option>
      <option value="cdistrict_5m_2020">Congressional District 2020 (5m)</option>
      <option value="cdistrict_5m_2021">Congressional District 2021 (5m)</option>
      <option value="cdistrict_5m_2022">Congressional District 2022 (5m)</option>
      <option value="cdistrict_5m_2023">Congressional District 2023 (5m)</option>
    </optgroup>
  </optgroup>
  <optgroup label="Resolution: 20m">
    <optgroup label="&nbsp;&nbsp;State">
      <option value="state_20m_2014">State 2014 (20m)</option>
      <option value="state_20m_2015">State 2015 (20m)</option>
      <option value="state_20m_2016">State 2016 (20m)</option>
      <option value="state_20m_2017">State 2017 (20m)</option>
      <option value="state_20m_2018">State 2018 (20m)</option>
      <option value="state_20m_2019">State 2019 (20m)</option>
      <option value="state_20m_2020">State 2020 (20m)</option>
      <option value="state_20m_2021">State 2021 (20m)</option>
      <option value="state_20m_2022">State 2022 (20m)</option>
      <option value="state_20m_2023">State 2023 (20m)</option>
    </optgroup>
    <optgroup label="&nbsp;&nbsp;County">
      <option value="county_20m_2014">County 2014 (20m)</option>
      <option value="county_20m_2015">County 2015 (20m)</option>
      <option value="county_20m_2016">County 2016 (20m)</option>
      <option value="county_20m_2017">County 2017 (20m)</option>
      <option value="county_20m_2018">County 2018 (20m)</option>
      <option value="county_20m_2019">County 2019 (20m)</option>
      <option value="county_20m_2020">County 2020 (20m)</option>
      <option value="county_20m_2021">County 2021 (20m)</option>
      <option value="county_20m_2022">County 2022 (20m)</option>
      <option value="county_20m_2023">County 2023 (20m)</option>
    </optgroup>
    <optgroup label="&nbsp;&nbsp;Congressional district">
      <option value="cdistrict_20m_2014">Congressional District 2014 (20m)</option>
      <option value="cdistrict_20m_2015">Congressional District 2015 (20m)</option>
      <option value="cdistrict_20m_2016">Congressional District 2016 (20m)</option>
      <option value="cdistrict_20m_2017">Congressional District 2017 (20m)</option>
      <option value="cdistrict_20m_2018">Congressional District 2018 (20m)</option>
      <option value="cdistrict_20m_2019">Congressional District 2019 (20m)</option>
      <option value="cdistrict_20m_2020">Congressional District 2020 (20m)</option>
      <option value="cdistrict_20m_2021">Congressional District 2021 (20m)</option>
      <option value="cdistrict_20m_2022">Congressional District 2022 (20m)</option>
      <option value="cdistrict_20m_2023">Congressional District 2023 (20m)</option>
    </optgroup>
  </optgroup>
</select>

<svg id="map" width = "1280" height = "800"></svg>

<div id="note"></div>

<script>
  let testString = function(x) {
      switch(true) {
      case /county/.test(x):
          return "counties";
          break;
      case /cdistrict/.test(x):
          return "cdistricts";
          break;
      case /state/.test(x):
          return "states";
          break;
      }
  }
  let getRes = function(x) {
      switch(true) {
      case /500k/.test(x):
          return "high";
          break;
      case /5m/.test(x):
          return "med";
          break;
      case /20m/.test(x):
          return "low";
          break;
      }
  }
  let loadData = function(datastr) {
      
      // load data and run
      Promise.all([
          d3.json("./data/json/" + datastr + ".json")
      ]).then(function([us]){

          const basegeo = testString(datastr);
          const resolution = getRes(datastr);
          
          // where the map is going
          const svg = d3.select("svg"),
                width = +svg.attr("width"),
                height = +svg.attr("height");
          
          // map and projection
          // const projection = geoAlbersUsaTer.geoAlbersUsaTer()
          //       .scale(1280)
          //       .translate([width / 2, height / 2]);
          // const path = d3.geoPath().projection(projection);
          const path = d3.geoPath()

          // drop old so it doesn't just keep appending
          svg.selectAll("path").remove();

          if (basegeo !== "states") {
              // draw counties / congressional districts
              svg.append("g")
                  .selectAll("path")
                  .data(topojson.feature(us, us.objects[basegeo]).features)
                  .join("path")
                  .attr("fill", "none")
                  .attr("stroke", "lightgrey")
                  .attr("d", path);
              
              // draw state outlines
              svg.append("path")
                  .datum(topojson.mesh(us, us.objects.states))
                  .attr("fill", "none")
                  .attr("stroke", "darkgrey")
                  .attr("stroke-linejoin", "round")
                  .attr("d", path);

          } else {
              // draw states
              svg.append("g")
                  .selectAll("path")
                  .data(topojson.feature(us, us.objects[basegeo]).features)
                  .join("path")
                  .attr("fill", "none")
                  .attr("stroke", "darkgrey")
                  .attr("d", path);
              
          }

          var notetext = "Note: Small geographic areas may be dropped ";
          notetext += "from lower resolution files (20m)."
          var div = document.getElementById("note");
          div.innerHTML = "";
          var note = document.createTextNode(notetext);

          if (resolution === "low") {
              var para = document.createElement("p");
              para.appendChild(note);
              div.appendChild(para);
          }               
      })

  }

  loadData("state_500k_2014");

  // handle on click event
  d3.select('#opts')
    .on('change', function() {
        var newData = d3.select(this).property('value');
        loadData(newData);
  });
  
</script>
